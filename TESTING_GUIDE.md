# 文件夹上传功能测试指南

## 🧪 测试环境准备

### 1. 启动前端开发服务器

```bash
npm install
npm run dev
```

访问: `http://localhost:5173/folder-upload`

### 2. 启动后端服务器（可选）

如果要测试真实的后端上传：

```bash
# 安装后端依赖
npm install express multer fs-extra cors

# 启动后端
node backend-example.js
```

后端运行在: `http://localhost:3000`

## 📋 测试用例

### 测试用例 1: 基本功能测试

#### 1.1 选择文件夹

- **操作**: 点击"选择文件夹"按钮
- **预期**: 弹出文件夹选择对话框
- **验证**:
  - ✅ 对话框正常弹出
  - ✅ 可以选择文件夹
  - ✅ 可以取消选择

#### 1.2 显示文件树

- **操作**: 选择一个包含多层文件夹的目录
- **预期**: 文件以树形结构显示在表格中
- **验证**:
  - ✅ 文件夹显示文件夹图标
  - ✅ 文件显示文件图标
  - ✅ 可以展开/折叠文件夹
  - ✅ 显示正确的文件名
  - ✅ 显示正确的文件大小
  - ✅ 显示正确的相对路径

#### 1.3 上传文件

- **操作**: 点击"开始上传"按钮
- **预期**: 文件开始上传
- **验证**:
  - ✅ 进度条开始移动
  - ✅ 状态变为"上传中"
  - ✅ 统计信息更新
  - ✅ 上传完成后状态变为"已完成"
  - ✅ 进度条显示100%

#### 1.4 暂停上传

- **操作**: 上传过程中点击"暂停上传"
- **预期**: 上传暂停
- **验证**:
  - ✅ 正在上传的文件停止
  - ✅ 状态变为"已暂停"
  - ✅ "开始上传"按钮可用

#### 1.5 继续上传

- **操作**: 暂停后点击"开始上传"
- **预期**: 继续上传
- **验证**:
  - ✅ 暂停的文件继续上传
  - ✅ 状态变为"上传中"
  - ✅ 进度继续增加

#### 1.6 清空列表

- **操作**: 点击"清空列表"
- **预期**: 文件列表清空
- **验证**:
  - ✅ 表格清空
  - ✅ 统计信息归零
  - ✅ 可以重新选择文件夹

### 测试用例 2: 边界条件测试

#### 2.1 空文件夹

- **操作**: 选择一个空文件夹
- **预期**: 显示空文件夹节点
- **验证**:
  - ✅ 显示文件夹名称
  - ✅ 没有子节点
  - ✅ 提示没有文件需要上传

#### 2.2 大量文件

- **操作**: 选择包含100+个文件的文件夹
- **预期**: 正常显示和上传
- **验证**:
  - ✅ 文件树正常渲染
  - ✅ 并发控制生效（最多6个）
  - ✅ 队列管理正常
  - ✅ 所有文件都能上传完成

#### 2.3 大文件

- **操作**: 上传100MB+的文件
- **预期**: 自动分片上传
- **验证**:
  - ✅ 文件被分成多个分片
  - ✅ 逐片上传
  - ✅ 进度平滑增加
  - ✅ 最终合并成功

#### 2.4 小文件

- **操作**: 上传小于2MB的文件
- **预期**: 单片上传
- **验证**:
  - ✅ 只有一个分片
  - ✅ 上传速度快
  - ✅ 正常完成

#### 2.5 深层嵌套

- **操作**: 选择嵌套层级很深的文件夹（10+层）
- **预期**: 正常显示和上传
- **验证**:
  - ✅ 树形结构正确
  - ✅ 路径显示正确
  - ✅ 上传保持文件夹结构

### 测试用例 3: 并发控制测试

#### 3.1 并发数限制

- **操作**: 选择10个文件，开始上传
- **预期**: 最多同时上传6个文件
- **验证**:
  - ✅ "上传中"数量不超过6
  - ✅ 其他文件在队列中等待
  - ✅ 完成一个后自动开始下一个

#### 3.2 队列管理

- **操作**: 观察上传队列的变化
- **预期**: 队列按顺序处理
- **验证**:
  - ✅ 文件按顺序上传
  - ✅ 队列长度逐渐减少
  - ✅ 所有文件都被处理

### 测试用例 4: 错误处理测试

#### 4.1 网络中断

- **操作**: 上传过程中断开网络
- **预期**: 上传失败，可重试
- **验证**:
  - ✅ 状态变为"失败"
  - ✅ 显示错误提示
  - ✅ 可以重新上传

#### 4.2 服务器错误

- **操作**: 模拟服务器返回500错误
- **预期**: 上传失败，可重试
- **验证**:
  - ✅ 状态变为"失败"
  - ✅ 错误信息显示
  - ✅ 可以重新上传

#### 4.3 超时

- **操作**: 模拟网络超时
- **预期**: 上传失败，可重试
- **验证**:
  - ✅ 超时后自动失败
  - ✅ 状态变为"失败"
  - ✅ 可以重新上传

### 测试用例 5: 断点续传测试

#### 5.1 部分分片已上传

- **操作**:
  1. 上传大文件
  2. 上传到50%时暂停
  3. 刷新页面
  4. 重新选择相同文件
  5. 开始上传
- **预期**: 只上传剩余的分片（需要后端支持）
- **验证**:
  - ✅ 检查已上传的分片
  - ✅ 只上传缺失的分片
  - ✅ 进度从50%开始

#### 5.2 秒传

- **操作**: 上传已经上传过的文件
- **预期**: 秒传成功（需要后端支持）
- **验证**:
  - ✅ 检测到文件已存在
  - ✅ 直接显示100%
  - ✅ 不发送分片请求

### 测试用例 6: UI/UX 测试

#### 6.1 进度显示

- **操作**: 观察上传进度
- **预期**: 进度平滑增加
- **验证**:
  - ✅ 进度条动画流畅
  - ✅ 百分比准确
  - ✅ 颜色变化正确

#### 6.2 状态显示

- **操作**: 观察状态变化
- **预期**: 状态准确显示
- **验证**:
  - ✅ 待上传 - 蓝色
  - ✅ 上传中 - 黄色
  - ✅ 已完成 - 绿色
  - ✅ 失败 - 红色
  - ✅ 已暂停 - 灰色

#### 6.3 统计信息

- **操作**: 观察统计信息
- **预期**: 实时更新
- **验证**:
  - ✅ 总文件数正确
  - ✅ 已上传数实时更新
  - ✅ 上传中数实时更新
  - ✅ 失败数正确统计

#### 6.4 按钮状态

- **操作**: 观察按钮的启用/禁用状态
- **预期**: 按钮状态正确
- **验证**:
  - ✅ 上传中时"开始上传"禁用
  - ✅ 未上传时"暂停上传"禁用
  - ✅ 上传中时"清空列表"禁用
  - ✅ 全部完成后"开始上传"禁用

### 测试用例 7: 性能测试

#### 7.1 内存占用

- **操作**: 上传大量大文件
- **预期**: 内存占用稳定
- **验证**:
  - ✅ 打开浏览器性能监控
  - ✅ 观察内存使用
  - ✅ 内存不持续增长
  - ✅ 上传完成后内存释放

#### 7.2 CPU 占用

- **操作**: 上传过程中观察CPU
- **预期**: CPU占用合理
- **验证**:
  - ✅ CPU占用不超过50%
  - ✅ 页面不卡顿
  - ✅ 其他操作正常

#### 7.3 网络带宽

- **操作**: 观察网络使用
- **预期**: 充分利用带宽
- **验证**:
  - ✅ 并发上传提高速度
  - ✅ 带宽利用率高
  - ✅ 不超过网络限制

## 🔍 测试工具

### 1. 浏览器开发者工具

#### Network 面板

```
- 查看请求数量
- 查看请求大小
- 查看请求时间
- 查看请求状态
```

#### Console 面板

```
- 查看日志输出
- 查看错误信息
- 查看警告信息
```

#### Performance 面板

```
- 录制性能
- 分析内存使用
- 分析CPU使用
```

### 2. 网络模拟

#### Chrome DevTools

```
1. 打开 Network 面板
2. 选择 Throttling
3. 选择网络速度:
   - Fast 3G
   - Slow 3G
   - Offline
```

### 3. 测试数据准备

#### 创建测试文件夹

```bash
# 创建测试目录
mkdir test-upload

# 创建多层文件夹
mkdir -p test-upload/folder1/subfolder1
mkdir -p test-upload/folder2/subfolder2

# 创建不同大小的测试文件
# 小文件 (< 2MB)
dd if=/dev/zero of=test-upload/small.txt bs=1M count=1

# 中等文件 (10MB)
dd if=/dev/zero of=test-upload/folder1/medium.txt bs=1M count=10

# 大文件 (100MB)
dd if=/dev/zero of=test-upload/folder2/large.txt bs=1M count=100

# 创建多个小文件
for i in {1..20}; do
  echo "Test file $i" > test-upload/folder1/subfolder1/file$i.txt
done
```

## 📊 测试报告模板

### 测试执行记录

| 测试用例       | 测试结果 | 问题描述 | 截图 |
| -------------- | -------- | -------- | ---- |
| 1.1 选择文件夹 | ✅ 通过  | -        | -    |
| 1.2 显示文件树 | ✅ 通过  | -        | -    |
| 1.3 上传文件   | ✅ 通过  | -        | -    |
| 1.4 暂停上传   | ✅ 通过  | -        | -    |
| 1.5 继续上传   | ✅ 通过  | -        | -    |
| 1.6 清空列表   | ✅ 通过  | -        | -    |
| ...            | ...      | ...      | ...  |

### 性能测试记录

| 测试项   | 测试数据  | 结果  | 备注     |
| -------- | --------- | ----- | -------- |
| 内存占用 | 100个文件 | 150MB | 正常     |
| CPU占用  | 上传中    | 30%   | 正常     |
| 上传速度 | 100MB文件 | 2MB/s | 正常     |
| 并发数   | 10个文件  | 6个   | 符合预期 |

### 问题列表

| 问题ID  | 严重程度 | 问题描述 | 重现步骤 | 状态   |
| ------- | -------- | -------- | -------- | ------ |
| BUG-001 | 高       | ...      | ...      | 待修复 |
| BUG-002 | 中       | ...      | ...      | 已修复 |

## 🐛 常见问题排查

### 问题1: 选择文件夹后没有反应

**排查步骤**:

1. 检查浏览器控制台是否有错误
2. 检查浏览器是否支持 `webkitdirectory`
3. 检查文件夹是否为空
4. 检查是否有权限访问文件夹

### 问题2: 上传失败

**排查步骤**:

1. 检查网络连接
2. 检查后端服务是否运行
3. 检查 API 地址是否正确
4. 检查浏览器控制台的网络请求
5. 检查后端日志

### 问题3: 进度不更新

**排查步骤**:

1. 检查 `onProgress` 回调是否正常
2. 检查响应式数据是否更新
3. 检查组件是否重新渲染
4. 检查浏览器性能

### 问题4: 内存泄漏

**排查步骤**:

1. 使用 Chrome Performance 面板录制
2. 检查是否有未释放的对象
3. 检查是否有循环引用
4. 检查事件监听器是否正确移除

## ✅ 测试清单

### 功能测试

- [ ] 文件夹选择
- [ ] 文件树显示
- [ ] 文件上传
- [ ] 进度显示
- [ ] 状态管理
- [ ] 暂停/继续
- [ ] 清空列表
- [ ] 统计信息

### 边界测试

- [ ] 空文件夹
- [ ] 大量文件
- [ ] 大文件
- [ ] 小文件
- [ ] 深层嵌套

### 并发测试

- [ ] 并发数限制
- [ ] 队列管理
- [ ] 任务调度

### 错误测试

- [ ] 网络错误
- [ ] 服务器错误
- [ ] 超时错误
- [ ] 取消上传

### 性能测试

- [ ] 内存占用
- [ ] CPU占用
- [ ] 网络带宽
- [ ] 渲染性能

### 兼容性测试

- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge

## 📝 测试总结

测试完成后，总结以下内容：

1. **测试覆盖率**: X%
2. **通过率**: X%
3. **发现问题数**: X个
4. **严重问题数**: X个
5. **性能评估**: 优秀/良好/一般/差
6. **建议改进**: ...
